# Ultralytics ğŸš€ AGPL-3.0 License - https://ultralytics.com/license
name: Check Broken links

on:
  workflow_dispatch:
  schedule:
    - cron: "0 0 * * *" # runs at 00:00 UTC every day

jobs:
  Links:
    runs-on: ubuntu-latest
    steps:
      - uses: actions/checkout@v4
        with:
          fetch-depth: 1 # ç¡®ä¿å®Œæ•´æ£€å‡ºä»£ç ï¼Œé¿å…æ–‡ä»¶ç¼ºå¤±

      - name: Install lychee (via Cargo, stable)
        run: |
          curl --proto '=https' --tlsv1.2 -sSf https://sh.rustup.rs | sh -s -- -y
          source $HOME/.cargo/env
          cargo install lychee --version 0.16.0
          lychee --version
        shell: bash

      - name: Test Markdown and HTML links with retry
        uses: ultralytics/actions/retry@main
        with:
          timeout_minutes: 5
          retry_delay_seconds: 60
          retries: 2
          # å…³é”®ï¼šæ”¹ç”¨å•è¡Œå‘½ä»¤ï¼ˆæ”¾å¼ƒbashç»­è¡Œç¬¦\ï¼‰ï¼Œç”¨YAMLçš„>æŠ˜å è¡Œï¼ˆè‡ªåŠ¨è½¬ç©ºæ ¼ï¼‰
          run: >
            set -euo pipefail;
            shopt -s globstar;
            # å•è¡Œæ‰§è¡Œlycheeï¼ˆæ‰€æœ‰å‚æ•°ç”¨ç©ºæ ¼åˆ†éš”ï¼Œå½»åº•é¿å…å‘½ä»¤æ‹†åˆ†ï¼‰
            lychee --scheme https --timeout 60 --insecure --accept 100..=103,200..=299,401,403,429,500,502,999 --exclude-all-private --exclude "https://*.linkedin.com,https://*.twitter.com,https://*.x.com,https://*.instagram.com,https://*.kaggle.com,https://*.fonts.gstatic.com,https://*.url.com,http://*.linkedin.com,http://*.twitter.com,http://*.x.com,http://*.instagram.com,http://*.kaggle.com,http://*.fonts.gstatic.com,http://*.url.com" --exclude-path "**/ci.yaml" --github-token ${{ secrets.GITHUB_TOKEN }} --header "User-Agent: Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/126.0.6478.183 Safari/537.36" ./**/*.md ./**/*.html | tee -a $GITHUB_STEP_SUMMARY;
            # æ£€æŸ¥è¾“å‡ºï¼ˆå…¼å®¹æ‰€æœ‰ç‰ˆæœ¬ï¼‰
            if ! grep -qi "0 error(s)\|0 Errors\|0 errors\|no broken links" "$GITHUB_STEP_SUMMARY"; then exit 1; fi

      - name: Test extended file types with retry (manual trigger only)
        if: github.event_name == 'workflow_dispatch'
        uses: ultralytics/actions/retry@main
        with:
          timeout_minutes: 5
          retry_delay_seconds: 60
          retries: 2
          run: >
            set -euo pipefail;
            shopt -s globstar;
            # å•è¡Œæ‰§è¡Œlycheeï¼ˆå¢åŠ æ›´å¤šæ–‡ä»¶ç±»å‹ï¼‰
            lychee --scheme https --timeout 60 --insecure --accept 100..=103,200..=299,429,999 --exclude-all-private --exclude "https://*.linkedin.com,https://*.twitter.com,https://*.x.com,https://*.instagram.com,https://*.kaggle.com,https://*.fonts.gstatic.com,https://*.url.com,http://*.linkedin.com,http://*.twitter.com,http://*.x.com,http://*.instagram.com,http://*.kaggle.com,http://*.fonts.gstatic.com,http://*.url.com" --exclude-path "**/ci.yaml" --github-token ${{ secrets.GITHUB_TOKEN }} --header "User-Agent: Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/126.0.6478.183 Safari/537.36" ./**/*.md ./**/*.html ./**/*.yml ./**/*.yaml ./**/*.py ./**/*.ipynb | tee -a $GITHUB_STEP_SUMMARY;
            # æ£€æŸ¥è¾“å‡º
            if ! grep -qi "0 error(s)\|0 Errors\|0 errors\|no broken links" "$GITHUB_STEP_SUMMARY"; then exit 1; fi
